#!/usr/bin/env python3

__author__ = "Mike Bond"
__email__ = "bondo.mike@gmail.com"
__copyright__ = "Copyright (c) 2019"
__credits__ = "Mike Bond"
__license__ = "MIT"
__originalDate__ = "20190725"
__modifiedDate__ = "20200731"
__version__ = "0.0.2"
__maintainer__ = "Mike Bond"
__status__ = "Beta"

"""
This script is used to start a local TFTP Server as root
"""

"""Import modules"""
import tftpy
import sys
import os

"""Define Color Status"""
error = '\033[1m\033[31m[!]\033[0m'
warning = '\033[1m\033[33m[-]\033[0m'
info = '\033[1m\033[94m[*]\033[0m'
complete = '\033[1m\033[92m[+]\033[0m'

""" Functions """
def main():
    """
    The main function that checks for root permissions and then starts the TFTP Server on
    Port 69
    :param:
    :return:
    """
    try:
        # Determine if root privileges being used
        if not os.geteuid() == 0:
            print("{0} TFTP_SRV must be run as root.".format(error))
            sys.exit(-1)
        service = tftpy.TftpServer('')
        print("{0} Listening on Port 69".format(info))
        print("Type \033[1m\033[93m^C\033[0m to Quit!")
        service.listen('0.0.0.0', 69)
    except Exception as e:
        print("\n{0} {1}\n".format(error, e))
        sys.exit(-1)
    except KeyboardInterrupt:
        print("\n{} User Interrupt! Quitting....\n".format(error))
        sys.exit(-1)

if __name__ == '__main__':
    main()
